; extensions.conf - the Asterisk dial plan
;
; Static extension configuration file, used by
; the pbx_config module. This is where you configure all your
; inbound and outbound calls in Asterisk.
;
; This configuration file is reloaded
; - With the "dialplan reload" command in the CLI
; - With the "reload" command (that reloads everything) in the CLI

[general]
static=yes
writeprotect=no
autofallthrough=yes

[globals]
CONF_PASSWORD=1234
;====================================================================================================
; ~~FUNCTII SIP~~
[meetme_conf]
exten => 100, 1, Answer
	same => n, Ringing
	same => n, Wait(2)
	same => n, agi(googletts.agi,"Va rugÄƒm introduceÈ›i parola", ro)
	same => n, Set(TIMEOUT(digit)=5)
	same => n, Read(digito,,4)
	same => n, GotoIf($["${digito}" == "${CONF_PASSWORD}"]?continue:Hangup())
	same => n(continue), Goto(conf,1)
exten => conf, 1, MeetMe(100,iTMs,CONF_PASSWORD)
	same => n, Hangup()

;Setari MeetMeCount, nr: 101
exten => 101, 1, Answer
	same => n, Ringing
	same => n, Wait(2)
	same => n, Goto(count,1)
;Spune cati utilizatori sunt conectati la conferinta
exten => count, 1, NoOp(Total: ${USERS} utilizatori) ; NoOp este folosit pentru afisare in consola asterisk
	same => n, Playback(conf-thereare)
	same => n, MeetMeCount(100)

;Seteaza MeetMeAdmin
exten => 102, 1, Answer
	same => n, Ringing
	same => n, Wait(2)
	same => n, Verbose(For kick all users press 1)
		same => n, Flite("Press 1 to kick everyone", en)
		same => n, Verbose(2, For lock conference press 2)
		same => n, Flite("Press 2 to lock the conference", en)
		same => n, Verbose(2, For unlock conference press 3)
		same => n, Flite("Press 3 to unlock the conference", en)
		same => n, Read(digito,,1)
		same => n, GotoIf(${digito} > 0?continue:Hangup())
		same => n(continue), Goto(admin_cmds_${digito},1)
; FUNCTII CU MACRO PENTRU MeetMeAdmin
;1. Da afara pe toata lumea
exten => admin_cmds_1, 1, MeetMeAdmin(100,K)
	same => n, Verbose(Everyone has been kicked from conference by ${CALLERIDNAME})

;2. Blocheaza conferinta
exten => admin_cmds_2, 1, MeetMeAdmin(100,L)
	same => n, Playback(conf-lockednow)
	same => n, Verbose(Conference was locked by ${CALLERIDNAME})

;3. Deblocheaza conferinta
exten => admin_cmds_3, 1, MeetMeAdmin(100,l)
same => n, Playback(conf-unlockednow)
	same => n, Verbose(Conference was unlocked by ${CALLERIDNAME})

;====================================================================================================
; ~~SIP CONTEXT~~
[grup-facultate-sip]
; Include meetme_conf functii doar pentru SIP
include => meetme_conf

exten => _30[00-2], 1, Flite("You are not authorized to access this function")

;Numere de telefon, care au acces la meetme
exten => 1126, 1, Dial(SIP/1126,20)
exten => 2126, 1, Dial(SIP/2126,20)

;Numere de telefon ce nu au acces la meetme dar pot suna pe sip
exten => 3126, 1, Goto(grup-facultate-iax,3126,1)
exten => 4126, 1, Goto(grup-facultate-iax,4126,1)

;====================================================================================================
; ~~IAX CONTEXT~~
[grup-facultate-iax]

; Daca suni la SIP nu ai acces, si vei auzi acest text
exten => _10[00-2], 1, Flite("You are not authorized to access this function")

; Daca suni ca iax pe sip sa te duca la functiile SIP de CALL, pe context grup facultate sip
exten => 1126,1, Goto(grup-facultate-sip,1126,1)
exten => 2126,1, Goto(grup-facultate-sip,2126,1)

;Numere de telefon pentru iax 3126/4126
exten => 3126, 1, Dial(IAX2/3126,20)
exten => 4126, 1, Dial(IAX2/4126,20)

;Timeout functions for IAX
exten => 300, 1, Answer
	same => n, Ringing
	same => n, Wait(1)
	same => n, Set(TIMEOUT(absolute)=4)
	;same => n, Playback() ; PUNE melodie de noi, "Timeout absolute a fost setat"

exten => 301, 1, Answer
	same => n, Ringing
	same => n, Wait(2)
	same => n, Set(TIMEOUT(digit)=5)
	;same => n, Playback() ; PUNE melodie de noi, "Timeout digit a fost setat"

exten => 302, 1, Answer
	same => n, Ringing
	same => n, Wait(1)
	same => n, GoTo(s,1)

exten => s, 1, Set(TIMEOUT(response)=5)
exten => s, 2, Background(welcome)
exten => s, 3, Read(digito,,1)
exten => s, 4, GotoIf($[${digito}]?5:6)
exten => s, 5, Playback(telephone-in-your-pocket)
exten => s, 6, Hangup()

exten => 2,1,Playback(goodbye)
	same => n, Hangup()

